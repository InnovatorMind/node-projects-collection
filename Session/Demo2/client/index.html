<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register & Login</title>
</head>

<body>
    <h2>Register</h2>
    <form id="registerForm">
        <input type="text" id="registerUsername" name="username" placeholder="Choose a username" required
            value="Amarjeet" /><br><br>
        <input type="email" id="registerEmail" name="email" placeholder="Enter your email" required
            value="amarjeet@gmail.com" /><br><br>
        <input type="password" id="registerPassword" name="password" placeholder="Create a password" required
            value="1234" /><br><br>
        <button type="submit">Register</button>
    </form>

    <hr>

    <h2>Login</h2>
    <form id="loginForm">
        <input type="email" id="loginEmail" name="email" placeholder="Your email" required
            value="amarjeet@gmail.com" /><br><br>
        <input type="password" id="loginPassword" name="password" placeholder="Your password" value="1234"
            required /><br><br>
        <button type="submit">Login</button>
    </form>

    <p id="response"></p>

    <script>
        const responseBox = document.getElementById("response");

        // Register Form Submission
        document.getElementById("registerForm").addEventListener("submit", async function (e) {
            e.preventDefault();

            const email = document.getElementById("registerEmail").value;
            const username = document.getElementById("registerUsername").value;
            const password = document.getElementById("registerPassword").value;

            console.log(email, username, password);

            try {
                const res = await fetch("http://localhost:3000/user/register", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, username, password }),
                });

                const data = await res.json();
                console.log(data)

                if (res.ok) {
                    // window.location.href = "/dashboard.html"; // ✅ Redirect after successful register
                    responseBox.innerText = "Registration Successful! Now please login";
                } else {
                    responseBox.innerText = data.message || "Registration failed!";
                }
            } catch (err) {
                responseBox.innerText = "Registration failed!";
                console.error(err);
            }
        });

        // Login Form Submission
        document.getElementById("loginForm").addEventListener("submit", async function (e) {
            e.preventDefault();

            const email = document.getElementById("loginEmail").value;
            const password = document.getElementById("loginPassword").value;

            try {
                const res = await fetch("http://localhost:3000/user/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    credentials: "include", // ✅ Required if using cookies
                    body: JSON.stringify({ email, password }),
                });

                const data = await res.json();

                if (res.ok) {
                    window.location.href = "/dashboard"; // ✅ Redirect after successful login
                    console.log({ login: "Success" });
                } else {
                    responseBox.innerText = data.message || "Login failed!";
                }
            } catch (err) {
                responseBox.innerText = "Login failed!";
                console.error(err);
            }
        });

    </script>
</body>

</html>